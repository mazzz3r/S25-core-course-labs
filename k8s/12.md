# Lab 12: Kubernetes ConfigMaps

## Task 1: Upgrade Application for Persistence

I've upgraded my Python application to include visit counting functionality:

1. Added a counter logic that tracks the number of visits
2. Implemented persistence by saving the counter to a `/data/visits` file
3. Created a new `/visits` endpoint to display the recorded visits
4. Updated docker-compose.yml to include a volume for persistence

## Task 2: ConfigMap Implementation

### Creating and Mounting ConfigMap

1. Created a `config.json` file in the `files` folder with application configuration
2. Created a ConfigMap manifest that extracts data from `config.json` using `.Files.Get`
3. Updated `deployment.yaml` with `Volumes` and `VolumeMounts` to mount the ConfigMap

### Verification

```bash
# Install the Helm chart
helm upgrade --install python-app ./helm-chart

# Output
Release "python-app" has been upgraded. Happy Helming!
NAME: python-app
LAST DEPLOYED: Sun Mar  9 15:22:47 2025
NAMESPACE: default
STATUS: deployed
REVISION: 8
TEST SUITE: None

# Get the list of pods
kubectl get po

# Output
NAME                                    READY   STATUS    RESTARTS   AGE
python-app-helm-chart-8bfbb66fd-89cqp   2/2     Running   0          70s
vault-0                                 1/1     Running   0          39m
vault-agent-injector-66f45b5fd5-5pmwf   1/1     Running   0          39m

# Check the ConfigMap inside the pod
kubectl exec -it $POD_NAME -- ls -la /etc/config

# Output
total 16
drwxrwxrwx 3 root root 4096 Mar  9 12:22 .
drwxr-xr-x 1 root root 4096 Mar  9 12:22 ..
drwxr-xr-x 2 root root 4096 Mar  9 12:22 ..2025_03_09_12_22_47.1424086879
lrwxrwxrwx 1 root root   32 Mar  9 12:22 ..data -> ..2025_03_09_12_22_47.1424086879
lrwxrwxrwx 1 root root   18 Mar  9 12:22 config.json -> ..data/config.json

# Check the content of the config.json file
kubectl exec -it $POD_NAME -- cat /etc/config/config.json

# Output
{
  "app": {
    "name": "python-app",
    "version": "1.0.0",
    "description": "A simple Flask application that counts visits",
    "settings": {
      "logLevel": "info",
      "dataPath": "/data",
      "visitsFile": "visits"
    }
  },
  "server": {
    "port": 8080,
    "host": "0.0.0.0"
  }
}
```

This confirms that the ConfigMap is successfully mounted in the pod at `/etc/config/config.json`.
